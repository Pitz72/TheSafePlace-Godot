<svg width="1100" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .data-source { fill: #1a365d; stroke: #2b6cb0; stroke-width: 3; }
      .processor { fill: #2d3748; stroke: #4a5568; stroke-width: 2; }
      .storage { fill: #553c9a; stroke: #805ad5; stroke-width: 2; }
      .output { fill: #742a2a; stroke: #c53030; stroke-width: 2; }
      .text { fill: white; font-family: 'Courier New', monospace; font-size: 10px; text-anchor: middle; }
      .title { fill: white; font-family: 'Courier New', monospace; font-size: 12px; font-weight: bold; text-anchor: middle; }
      .data-flow { stroke: #68d391; stroke-width: 2; fill: none; marker-end: url(#arrow); }
      .signal-flow { stroke: #f56565; stroke-width: 2; fill: none; stroke-dasharray: 4,4; marker-end: url(#signal-arrow); }
      .persistence { stroke: #fbb6ce; stroke-width: 3; fill: none; marker-end: url(#persist-arrow); }
      .label { fill: #e2e8f0; font-family: 'Courier New', monospace; font-size: 9px; text-anchor: middle; }
    </style>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#68d391" />
    </marker>
    <marker id="signal-arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f56565" />
    </marker>
    <marker id="persist-arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#fbb6ce" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="550" y="25" class="title" font-size="16">DATA FLOW DIAGRAM</text>
  <text x="550" y="45" class="text">Information Flow in The Safe Place</text>
  
  <!-- Data Sources (Top Layer) -->
  <!-- JSON Files -->
  <rect x="50" y="80" width="120" height="60" class="data-source" rx="5"/>
  <text x="110" y="105" class="title">JSON Files</text>
  <text x="110" y="120" class="text">items.json</text>
  <text x="110" y="135" class="text">events.json</text>
  
  <!-- User Input -->
  <rect x="200" y="80" width="120" height="60" class="data-source" rx="5"/>
  <text x="260" y="105" class="title">User Input</text>
  <text x="260" y="120" class="text">Keyboard</text>
  <text x="260" y="135" class="text">Mouse</text>
  
  <!-- Game Events -->
  <rect x="350" y="80" width="120" height="60" class="data-source" rx="5"/>
  <text x="410" y="105" class="title">Game Events</text>
  <text x="410" y="120" class="text">Random</text>
  <text x="410" y="135" class="text">Triggered</text>
  
  <!-- Save Files -->
  <rect x="500" y="80" width="120" height="60" class="data-source" rx="5"/>
  <text x="560" y="105" class="title">Save Files</text>
  <text x="560" y="120" class="text">player.save</text>
  <text x="560" y="135" class="text">world.save</text>
  
  <!-- System State -->
  <rect x="650" y="80" width="120" height="60" class="data-source" rx="5"/>
  <text x="710" y="105" class="title">System State</text>
  <text x="710" y="120" class="text">Time</text>
  <text x="710" y="135" class="text">Environment</text>
  
  <!-- Processing Layer (Middle) -->
  <!-- DataManager -->
  <rect x="100" y="200" width="120" height="80" class="processor" rx="5"/>
  <text x="160" y="225" class="title">DataManager</text>
  <text x="160" y="240" class="text">JSON Parser</text>
  <text x="160" y="255" class="text">Data Validation</text>
  <text x="160" y="270" class="text">Cache Manager</text>
  
  <!-- InputManager -->
  <rect x="250" y="200" width="120" height="80" class="processor" rx="5"/>
  <text x="310" y="225" class="title">InputManager</text>
  <text x="310" y="240" class="text">Input Mapping</text>
  <text x="310" y="255" class="text">State Machine</text>
  <text x="310" y="270" class="text">Signal Router</text>
  
  <!-- EventManager -->
  <rect x="400" y="200" width="120" height="80" class="processor" rx="5"/>
  <text x="460" y="225" class="title">EventManager</text>
  <text x="460" y="240" class="text">Event Queue</text>
  <text x="460" y="255" class="text">Skill Checks</text>
  <text x="460" y="270" class="text">Consequences</text>
  
  <!-- SaveLoadManager -->
  <rect x="550" y="200" width="120" height="80" class="processor" rx="5"/>
  <text x="610" y="225" class="title">SaveLoadManager</text>
  <text x="610" y="240" class="text">Serialization</text>
  <text x="610" y="255" class="text">File I/O</text>
  <text x="610" y="270" class="text">Validation</text>
  
  <!-- TimeManager -->
  <rect x="700" y="200" width="120" height="80" class="processor" rx="5"/>
  <text x="760" y="225" class="title">TimeManager</text>
  <text x="760" y="240" class="text">Day/Night</text>
  <text x="760" y="255" class="text">Survival Timer</text>
  <text x="760" y="270" class="text">Events Trigger</text>
  
  <!-- Core State (Central Hub) -->
  <rect x="350" y="350" width="200" height="100" class="storage" rx="10"/>
  <text x="450" y="380" class="title" font-size="14">PLAYER STATE</text>
  <text x="450" y="400" class="text">Stats • Inventory • Skills</text>
  <text x="450" y="415" class="text">Emotions • Memory • Progress</text>
  <text x="450" y="430" class="text">Location • Relationships</text>
  <text x="450" y="445" class="text">Quest Status • Achievements</text>
  
  <!-- Game Systems (Processing Layer 2) -->
  <!-- CraftingManager -->
  <rect x="50" y="500" width="120" height="80" class="processor" rx="5"/>
  <text x="110" y="525" class="title">CraftingManager</text>
  <text x="110" y="540" class="text">Recipe Check</text>
  <text x="110" y="555" class="text">Resource Use</text>
  <text x="110" y="570" class="text">Item Creation</text>
  
  <!-- QuestManager -->
  <rect x="200" y="500" width="120" height="80" class="processor" rx="5"/>
  <text x="260" y="525" class="title">QuestManager</text>
  <text x="260" y="540" class="text">Progress Track</text>
  <text x="260" y="555" class="text">Completion</text>
  <text x="260" y="570" class="text">Rewards</text>
  
  <!-- CombatManager -->
  <rect x="350" y="500" width="120" height="80" class="processor" rx="5"/>
  <text x="410" y="525" class="title">CombatManager</text>
  <text x="410" y="540" class="text">Turn System</text>
  <text x="410" y="555" class="text">Damage Calc</text>
  <text x="410" y="570" class="text">Status Effects</text>
  
  <!-- NarrativeManager -->
  <rect x="500" y="500" width="120" height="80" class="processor" rx="5"/>
  <text x="560" y="525" class="title">NarrativeManager</text>
  <text x="560" y="540" class="text">Emotion Track</text>
  <text x="560" y="555" class="text">Memory Store</text>
  <text x="560" y="570" class="text">Story Branch</text>
  
  <!-- ThemeManager -->
  <rect x="650" y="500" width="120" height="80" class="processor" rx="5"/>
  <text x="710" y="525" class="title">ThemeManager</text>
  <text x="710" y="540" class="text">CRT Shader</text>
  <text x="710" y="555" class="text">UI Themes</text>
  <text x="710" y="570" class="text">Visual FX</text>
  
  <!-- Output Layer (Bottom) -->
  <!-- Game World -->
  <rect x="100" y="650" width="120" height="60" class="output" rx="5"/>
  <text x="160" y="675" class="title">Game World</text>
  <text x="160" y="690" class="text">Scene Updates</text>
  <text x="160" y="705" class="text">Object States</text>
  
  <!-- UI System -->
  <rect x="250" y="650" width="120" height="60" class="output" rx="5"/>
  <text x="310" y="675" class="title">UI System</text>
  <text x="310" y="690" class="text">HUD Updates</text>
  <text x="310" y="705" class="text">Menus</text>
  
  <!-- Audio System -->
  <rect x="400" y="650" width="120" height="60" class="output" rx="5"/>
  <text x="460" y="675" class="title">Audio System</text>
  <text x="460" y="690" class="text">SFX</text>
  <text x="460" y="705" class="text">Music</text>
  
  <!-- Visual Effects -->
  <rect x="550" y="650" width="120" height="60" class="output" rx="5"/>
  <text x="610" y="675" class="title">Visual Effects</text>
  <text x="610" y="690" class="text">Shaders</text>
  <text x="610" y="705" class="text">Particles</text>
  
  <!-- Persistence -->
  <rect x="700" y="650" width="120" height="60" class="output" rx="5"/>
  <text x="760" y="675" class="title">File System</text>
  <text x="760" y="690" class="text">Save Files</text>
  <text x="760" y="705" class="text">Logs</text>
  
  <!-- Data Flow Arrows -->
  <!-- Sources to Processors -->
  <path d="M 110 140 L 160 200" class="data-flow"/>
  <path d="M 260 140 L 310 200" class="data-flow"/>
  <path d="M 410 140 L 460 200" class="data-flow"/>
  <path d="M 560 140 L 610 200" class="data-flow"/>
  <path d="M 710 140 L 760 200" class="data-flow"/>
  
  <!-- Processors to Central State -->
  <path d="M 220 240 Q 300 300 350 380" class="data-flow"/>
  <path d="M 370 240 Q 400 300 420 350" class="data-flow"/>
  <path d="M 520 240 Q 500 300 480 350" class="data-flow"/>
  <path d="M 670 240 Q 600 300 550 380" class="data-flow"/>
  
  <!-- Central State to Game Systems -->
  <path d="M 350 420 Q 250 460 110 500" class="data-flow"/>
  <path d="M 380 450 Q 320 475 260 500" class="data-flow"/>
  <path d="M 450 450 L 410 500" class="data-flow"/>
  <path d="M 520 450 Q 540 475 560 500" class="data-flow"/>
  <path d="M 550 420 Q 650 460 710 500" class="data-flow"/>
  
  <!-- Game Systems to Outputs -->
  <path d="M 110 580 Q 135 615 160 650" class="data-flow"/>
  <path d="M 260 580 Q 285 615 310 650" class="data-flow"/>
  <path d="M 410 580 L 460 650" class="data-flow"/>
  <path d="M 560 580 Q 585 615 610 650" class="data-flow"/>
  <path d="M 710 580 Q 735 615 760 650" class="data-flow"/>
  
  <!-- Signal Communications -->
  <path d="M 310 280 Q 380 320 450 350" class="signal-flow"/>
  <path d="M 460 280 Q 450 320 450 350" class="signal-flow"/>
  
  <!-- Persistence Flows -->
  <path d="M 610 280 Q 680 400 760 650" class="persistence"/>
  <path d="M 760 650 Q 680 400 610 280" class="persistence"/>
  
  <!-- Labels -->
  <text x="135" y="170" class="label">Load</text>
  <text x="285" y="170" class="label">Process</text>
  <text x="435" y="170" class="label">Queue</text>
  <text x="585" y="170" class="label">Serialize</text>
  <text x="735" y="170" class="label">Update</text>
  
  <text x="275" y="320" class="label">State Updates</text>
  <text x="475" y="320" class="label">Events</text>
  
  <text x="720" y="400" class="label">Save/Load</text>
  
  <!-- Performance Metrics -->
  <g id="performance">
    <rect x="50" y="750" width="1000" height="120" fill="#1a202c" stroke="#4a5568" stroke-width="1" rx="5"/>
    <text x="550" y="775" class="title" font-size="14">DATA FLOW PERFORMANCE</text>
    
    <text x="70" y="800" class="text">• JSON Loading: ~50ms (cached dopo primo load)</text>
    <text x="70" y="815" class="text">• Input Processing: &lt;1ms per frame</text>
    <text x="70" y="830" class="text">• State Updates: ~2-5ms per frame</text>
    <text x="70" y="845" class="text">• Save Operations: ~500ms (async)</text>
    
    <text x="550" y="800" class="text">• Event Queue: Max 100 eventi/frame</text>
    <text x="550" y="815" class="text">• Signal Propagation: &lt;0.1ms</text>
    <text x="550" y="830" class="text">• Memory Usage: ~50MB runtime</text>
    <text x="550" y="845" class="text">• Cache Hit Rate: >95% per dati statici</text>
  </g>
</svg>